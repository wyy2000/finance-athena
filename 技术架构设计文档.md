# 银行投资风险审核系统技术架构设计文档

## 1. 项目概述

### 1.1 项目背景
银行需要为客户提供智能化的投资风险评估和审核服务。传统的投资风险评估流程存在效率低、标准化程度不高等问题。本系统能够根据客户的基本信息、财务状况和风险偏好，自动化地进行风险评估和投资建议生成，并通过多级审核机制确保审核流程的规范性和准确性。

### 1.2 技术栈选择
- **后端框架**: Python 3.10 + FastAPI
- **数据库**: MySQL 8.0
- **前端**: HTML + CSS + JavaScript (基于提供的demo页面)
- **消息队列**: Redis (用于异步任务和缓存)
- **部署**: Docker + Docker Compose

## 2. 系统架构设计

### 2.1 整体架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端页面      │    │   API网关       │    │   业务服务      │
│  (HTML/CSS/JS)  │◄──►│   (FastAPI)     │◄──►│   (Python)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   消息队列      │    │   数据库        │
                       │   (Redis)       │    │   (MySQL)       │
                       └─────────────────┘    └─────────────────┘
```

### 2.2 核心模块设计
1. **用户管理模块**: 客户信息管理、认证授权
2. **风险评估模块**: 风险评分算法、问卷处理
3. **投资建议模块**: 投资组合生成、产品推荐
4. **审核流程模块**: 多级审核、流程管理
5. **通知模块**: 短信通知、邮件通知
6. **报表模块**: 审核统计、数据分析

## 3. 数据库设计

### 3.1 数据库表结构

#### 3.1.1 客户信息表 (customers)
```sql
CREATE TABLE customers (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    phone VARCHAR(20) NOT NULL UNIQUE COMMENT '手机号',
    id_card VARCHAR(18) NOT NULL UNIQUE COMMENT '身份证号',
    email VARCHAR(100) COMMENT '邮箱',
    occupation VARCHAR(100) COMMENT '职业',
    investment_amount DECIMAL(15,2) COMMENT '投资金额',
    age_range VARCHAR(20) COMMENT '年龄范围',
    income_level VARCHAR(20) COMMENT '收入水平',
    investment_experience VARCHAR(20) COMMENT '投资经验',
    risk_tolerance VARCHAR(20) COMMENT '风险承受能力',
    investment_goal VARCHAR(20) COMMENT '投资目标',
    investment_period VARCHAR(20) COMMENT '投资期限',
    risk_score INT DEFAULT 0 COMMENT '风险评分',
    risk_level ENUM('conservative', 'moderate', 'aggressive') COMMENT '风险等级',
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT '状态',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 3.1.2 风险评估记录表 (risk_assessments)
```sql
CREATE TABLE risk_assessments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL,
    assessment_data JSON COMMENT '评估问卷数据',
    risk_score INT NOT NULL COMMENT '风险评分',
    risk_level ENUM('conservative', 'moderate', 'aggressive') NOT NULL,
    assessment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

#### 3.1.3 投资建议表 (investment_advice)
```sql
CREATE TABLE investment_advice (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL,
    portfolio_type ENUM('conservative', 'moderate', 'aggressive') NOT NULL,
    expected_return_min DECIMAL(5,2) COMMENT '预期最低收益',
    expected_return_max DECIMAL(5,2) COMMENT '预期最高收益',
    portfolio_config JSON COMMENT '投资组合配置',
    advice_content TEXT COMMENT '投资建议内容',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

#### 3.1.4 审核员表 (auditors)
```sql
CREATE TABLE auditors (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    role ENUM('junior', 'senior', 'expert', 'committee') NOT NULL,
    department VARCHAR(100) COMMENT '部门',
    phone VARCHAR(20) COMMENT '联系电话',
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.1.5 审核记录表 (audit_records)
```sql
CREATE TABLE audit_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL,
    auditor_id BIGINT NOT NULL,
    audit_level ENUM('junior', 'senior', 'expert', 'committee') NOT NULL,
    audit_status ENUM('pending', 'approved', 'rejected', 'need_review') NOT NULL,
    audit_opinion TEXT COMMENT '审核意见',
    audit_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id),
    FOREIGN KEY (auditor_id) REFERENCES auditors(id)
);
```

#### 3.1.6 审核流程表 (audit_workflow)
```sql
CREATE TABLE audit_workflow (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL,
    current_level ENUM('junior', 'senior', 'expert', 'committee') NOT NULL,
    workflow_status ENUM('pending', 'in_progress', 'completed', 'rejected') DEFAULT 'pending',
    assigned_auditor_id BIGINT COMMENT '当前审核员ID',
    next_level ENUM('junior', 'senior', 'expert', 'committee', 'completed') COMMENT '下一级审核',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id),
    FOREIGN KEY (assigned_auditor_id) REFERENCES auditors(id)
);
```

#### 3.1.7 通知记录表 (notifications)
```sql
CREATE TABLE notifications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL,
    notification_type ENUM('sms', 'email', 'system') NOT NULL,
    title VARCHAR(200) COMMENT '通知标题',
    content TEXT NOT NULL COMMENT '通知内容',
    status ENUM('pending', 'sent', 'failed') DEFAULT 'pending',
    sent_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

## 4. 后端API设计

### 4.1 API路由结构
```
/api/v1/
├── customers/           # 客户相关API
│   ├── POST /register   # 客户注册
│   ├── POST /assessment # 提交风险评估
│   ├── GET /{id}        # 获取客户信息
│   └── GET /{id}/advice # 获取投资建议
├── auditors/            # 审核员相关API
│   ├── POST /login      # 审核员登录
│   ├── GET /workflow    # 获取审核工作台
│   └── POST /audit      # 提交审核结果
├── workflow/            # 审核流程API
│   ├── GET /pending     # 获取待审核列表
│   └── POST /assign     # 分配审核任务
└── notifications/       # 通知相关API
    ├── POST /send       # 发送通知
    └── GET /history     # 获取通知历史
```

### 4.2 核心API接口

#### 4.2.1 客户注册和风险评估
```python
# POST /api/v1/customers/register
{
    "name": "张三",
    "phone": "13800138000",
    "id_card": "110101199001011234",
    "email": "zhangsan@example.com",
    "occupation": "工程师",
    "investment_amount": 500000,
    "assessment_data": {
        "age": "31-45岁",
        "income": "30-50万",
        "experience": "3-5年",
        "risk_tolerance": "15-30%",
        "goal": "积极增长",
        "period": "3-5年"
    }
}

# 响应
{
    "code": 200,
    "message": "注册成功",
    "data": {
        "customer_id": 123,
        "risk_score": 75,
        "risk_level": "moderate",
        "workflow_id": "WF20240716001"
    }
}
```

#### 4.2.2 获取投资建议
```python
# GET /api/v1/customers/{customer_id}/advice
# 响应
{
    "code": 200,
    "data": {
        "customer_info": {...},
        "risk_assessment": {...},
        "investment_advice": {
            "portfolio_type": "moderate",
            "expected_return": "6-10%",
            "portfolio_config": {
                "mixed_fund": 35,
                "bond_fund": 25,
                "quality_stocks": 25,
                "money_fund": 15
            },
            "advice_content": "基于您的风险偏好..."
        },
        "audit_status": "approved"
    }
}
```

#### 4.2.3 审核员工作台
```python
# GET /api/v1/auditors/workflow
# 响应
{
    "code": 200,
    "data": {
        "pending_count": 12,
        "approved_count": 35,
        "need_review_count": 5,
        "total_investment": 280000000,
        "pending_list": [
            {
                "customer_id": 123,
                "customer_name": "张三",
                "application_id": "RA-001",
                "investment_amount": 500000,
                "risk_level": "moderate",
                "submitted_at": "2024-07-16T09:30:00Z",
                "priority": "normal"
            }
        ]
    }
}
```

## 5. 核心业务逻辑

### 5.1 风险评估算法
```python
class RiskAssessmentService:
    def calculate_risk_score(self, assessment_data: dict) -> int:
        """计算风险评分"""
        score = 50  # 基础分
        
        # 年龄影响
        age_scores = {
            "18-30岁": 15,
            "31-45岁": 10,
            "46-60岁": 5,
            "60岁以上": -10
        }
        score += age_scores.get(assessment_data.get("age"), 0)
        
        # 收入影响
        income_scores = {
            "50万以上": 15,
            "30-50万": 10,
            "10-30万": 5,
            "10万以下": 0
        }
        score += income_scores.get(assessment_data.get("income"), 0)
        
        # 投资经验影响
        experience_scores = {
            "5年以上": 15,
            "3-5年": 10,
            "1-3年": 5,
            "无经验": 0
        }
        score += experience_scores.get(assessment_data.get("experience"), 0)
        
        # 风险承受能力影响
        tolerance_scores = {
            "30%以上": 20,
            "15-30%": 10,
            "5-15%": 5,
            "5%以内": -10
        }
        score += tolerance_scores.get(assessment_data.get("risk_tolerance"), 0)
        
        # 投资目标影响
        goal_scores = {
            "追求高收益": 15,
            "积极增长": 10,
            "稳健增值": 5,
            "资产保值": -5
        }
        score += goal_scores.get(assessment_data.get("goal"), 0)
        
        # 投资期限影响
        period_scores = {
            "5年以上": 10,
            "3-5年": 5,
            "1-3年": 0,
            "1年以内": -10
        }
        score += period_scores.get(assessment_data.get("period"), 0)
        
        return max(0, min(100, score))
    
    def determine_risk_level(self, score: int) -> str:
        """确定风险等级"""
        if score < 40:
            return "conservative"
        elif score < 70:
            return "moderate"
        else:
            return "aggressive"
```

### 5.2 投资建议生成
```python
class InvestmentAdviceService:
    def generate_portfolio(self, risk_level: str, investment_amount: float) -> dict:
        """生成投资组合建议"""
        portfolios = {
            "conservative": {
                "portfolio_type": "conservative",
                "expected_return": "4-6%",
                "portfolio_config": {
                    "money_fund": 40,
                    "government_bonds": 30,
                    "bank_products": 20,
                    "bond_fund": 10
                }
            },
            "moderate": {
                "portfolio_type": "moderate",
                "expected_return": "6-10%",
                "portfolio_config": {
                    "mixed_fund": 35,
                    "bond_fund": 25,
                    "quality_stocks": 25,
                    "money_fund": 15
                }
            },
            "aggressive": {
                "portfolio_type": "aggressive",
                "expected_return": "10-15%",
                "portfolio_config": {
                    "growth_stocks": 50,
                    "tech_fund": 25,
                    "emerging_markets": 15,
                    "bond_fund": 10
                }
            }
        }
        
        return portfolios.get(risk_level, portfolios["moderate"])
```

### 5.3 审核流程管理
```python
class AuditWorkflowService:
    def create_workflow(self, customer_id: int, risk_level: str, investment_amount: float) -> str:
        """创建审核流程"""
        # 根据风险等级和投资金额确定审核流程
        if risk_level == "conservative":
            levels = ["junior"]
        elif risk_level == "moderate":
            levels = ["junior", "senior"]
            if investment_amount > 1000000:  # 100万以上需要高级审核
                levels.append("expert")
        else:  # aggressive
            levels = ["junior", "senior", "expert", "committee"]
        
        # 创建审核流程记录
        workflow_id = f"WF{datetime.now().strftime('%Y%m%d%H%M%S')}"
        
        # 分配第一个审核员
        first_auditor = self.assign_auditor(levels[0])
        
        return workflow_id
    
    def assign_auditor(self, level: str) -> int:
        """分配审核员"""
        # 根据审核级别分配合适的审核员
        pass
    
    def process_audit(self, workflow_id: str, auditor_id: int, 
                     audit_result: str, opinion: str) -> bool:
        """处理审核结果"""
        # 更新审核状态
        # 如果通过，流转到下一级
        # 如果拒绝，结束流程
        pass
```

## 6. 项目结构

```
finance-athena/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py                 # FastAPI应用入口
│   │   ├── config.py               # 配置文件
│   │   ├── database.py             # 数据库连接
│   │   ├── models/                 # 数据模型
│   │   │   ├── __init__.py
│   │   │   ├── customer.py
│   │   │   ├── auditor.py
│   │   │   └── workflow.py
│   │   ├── schemas/                # Pydantic模型
│   │   │   ├── __init__.py
│   │   │   ├── customer.py
│   │   │   └── audit.py
│   │   ├── services/               # 业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── risk_assessment.py
│   │   │   ├── investment_advice.py
│   │   │   └── audit_workflow.py
│   │   ├── api/                    # API路由
│   │   │   ├── __init__.py
│   │   │   ├── customers.py
│   │   │   ├── auditors.py
│   │   │   └── workflow.py
│   │   └── utils/                  # 工具函数
│   │       ├── __init__.py
│   │       ├── auth.py
│   │       └── notification.py
│   ├── requirements.txt            # Python依赖
│   ├── Dockerfile                  # Docker配置
│   └── docker-compose.yml          # Docker Compose配置
├── frontend/
│   ├── static/                     # 静态文件
│   │   ├── css/
│   │   ├── js/
│   │   └── images/
│   ├── templates/                  # HTML模板
│   │   ├── customer.html
│   │   └── auditor.html
│   └── index.html                  # 主页面
├── database/
│   ├── init.sql                    # 数据库初始化脚本
│   └── migrations/                 # 数据库迁移文件
├── docs/                           # 文档
│   └── api.md
└── README.md                       # 项目说明
```

## 7. 部署方案

### 7.1 Docker部署
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql://user:password@db:3306/finance_athena
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

  db:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=finance_athena
      - MYSQL_USER=user
      - MYSQL_PASSWORD=password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  mysql_data:
```

### 7.2 环境配置
```python
# config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # 数据库配置
    database_url: str = "mysql://user:password@localhost:3306/finance_athena"
    
    # Redis配置
    redis_url: str = "redis://localhost:6379"
    
    # JWT配置
    secret_key: str = "your-secret-key"
    algorithm: str = "HS256"
    access_token_expire_minutes: int = 30
    
    # 短信服务配置
    sms_api_key: str = ""
    sms_api_secret: str = ""
    
    class Config:
        env_file = ".env"

settings = Settings()
```

## 8. 开发计划

### 8.1 MVP版本功能
1. **客户注册和风险评估** (Week 1-2)
   - 客户信息收集
   - 风险评估问卷
   - 风险评分算法

2. **投资建议生成** (Week 2-3)
   - 投资组合生成
   - 投资建议展示

3. **基础审核流程** (Week 3-4)
   - 初级审核员审核
   - 审核状态管理

4. **前端页面集成** (Week 4-5)
   - 客户页面功能完善
   - 审核员工作台

### 8.2 后续功能扩展
1. **多级审核流程**
2. **短信通知功能**
3. **数据统计报表**
4. **系统监控和日志**
5. **性能优化**

## 9. 技术要点

### 9.1 安全性考虑
- 客户信息加密存储
- API接口认证授权
- SQL注入防护
- XSS攻击防护

### 9.2 性能优化
- 数据库索引优化
- Redis缓存策略
- API响应时间优化
- 并发处理能力

### 9.3 可扩展性
- 微服务架构预留
- 模块化设计
- 配置化管理
- 插件化扩展

这个技术架构设计文档提供了一个完整的MVP版本实现方案，基于Python 3.10和MySQL，结合您提供的demo前端页面，能够快速搭建一个功能完整的银行投资风险审核系统。
